<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>智能车</title>
<!-- Bootstrap -->
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<!-- Main -->
<link rel="stylesheet" type="text/css" href="css/main.css">
<!-- Font-awesome -->
<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
<!-- Animate -->
<link rel="stylesheet" type="text/css" href="css/animate.css">


</head>

<body style="">
	<div class="container">
		<div class="row">
			<div class="col-sm-12">
				<div class="row header" style="background-color: #171717;display: block;">
					<div class="logo col-sm-8 col-sm-offset-1 col-xs-6">智能车云平台</div>
					<div class="header-right">
						<img src="image/avatar.png" class="user-picture">
						<span class="user-name">admin</span>
					</div>
				</div>

				<div class="row">
					<div class="col-sm-2 col-md-2 col-xs-12 menu" style="height:80px;min-width: 130px;padding: 0; background-color: rgba(37,37,37,1);">
						<ul style="list-style: none;">
							<li class="col-sm-12 hidden-xs" style="height: 80px;line-height:80px; font-size: 1.2em;letter-spacing:3px">
								<i class="fa fa-navicon" style="font-size: 1.4em;"></i>
							</li>
							<li class="col-sm-12" onclick="javascript:window.location.href='dashboard.html'">
								<i class="fa fa-list-alt"></i>车辆概况
								<span class="green">36</span>
								<span class="orange" style="margin-left: 45px;">7</span>
							</li>
							<li class="col-sm-12" style="background-color: #EAEDEB;color: #000;">
								<i class="fa fa-map"></i>车辆分布
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='log.html'">
								<i class="fa fa-list-ol"></i>车辆日志
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='warning.html'">
								<i class="fa fa-warning"></i>车辆异常
								<span class="red">12</span>
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='users.html'">
								<i class="fa fa-users"></i>用户管理
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='car_type.html'">
								<i class="fa fa-truck"></i>车型管理
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='car.html'">
								<i class="fa fa-car"></i>车辆管理
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='car_team.html'">
								<i class="fa fa-bicycle"></i>车队管理
							</li>
							<li class="col-sm-12"  onclick="javascript:window.location.href='push.html'">
								<i class="fa fa-envelope"></i>推送设置
							</li>
						</ul>
						<div class="menu_after"></div>
					</div>
					<div class="col-sm-10 control" style="background-color: #f4f3f2;">
						<div class="row general center">
							<div class="col-md-1 online-title is-online">在线</div>
							<div class="col-md-1 offline-title">离线</div>
							<div class="search-online">
								<input type="text" name="search" placeholder="搜索关键字">
								<i class="fa fa-search" style="position: absolute;right: 15px; top: 8px; color: #ddd;font-size: 1.5em;"></i>
							</div>
						</div>

						<div class="row">
							<div class="filter">
								<div class="filter-title center" style="background-color: #f4f3f2;">
										条件排序
								</div>
								<div class="filter-title center" data="speed">
									地域
								</div>
								<div  class="filter-title center" data="size">
									车型
								</div>
								<div class="filter-title center" data="brake">
									车队
								</div>
								<div class="filter-title center" data="angel">
									投放时间
								</div>
								<div class="filter-title center" data="exception">
									故障
								</div>
								<div class="filter-go center">
									筛选
								</div>

								<div class="filter-content">
 									<div class="speed">
										省:<select id="s_province" name="s_province"></select>  
    									市:<select id="s_city" name="s_city" ></select>  
    									县:<select id="s_county" name="s_county"></select>
									</div>
									<div class="size">
										车型:<select>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
											</select>
										品牌:<select>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
											</select>
										型号:<select>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
												<option>[长]3M*[宽]3M*[高]3M</option>
											</select>
									</div>
									<div class="brake">
										名称:<input type="" name="">
										编号:<input type="" name="">
									</div>

									<div class="angel">
										从<input type="date" name="">&nbsp;&nbsp;
										至
										<input type="date" name="">&nbsp;&nbsp;
									</div>

									<div class="exception">
										<div>
											<input type="checkbox" name="brake" value="BrakePedalStatus" id="BrakePedalStatus" ><label for="BrakePedalStatus">BrakePedalStatus</label><br>
         									<input type="checkbox" name="brake" value="BrakeAppliedStatus" id="BrakeAppliedStatus" ><label for="BrakeAppliedStatus">BrakeAppliedStatus</label>
         								</div>
         								<div>
        									<input type="checkbox" name="brake" value="TractionControlStatus" id="TractionControlStatus" ><label for="TractionControlStatus">TractionControlStatus</label><br>
        									<input type="checkbox" name="brake" value="AntiLockBrakeStatus" id="AntiLockBrakeStatus" ><label for="AntiLockBrakeStatus">AntiLockBrakeStatus</label>
        								</div>
        								<div>
        									<input type="checkbox" name="brake" value="StabilityControlStatus" id="StabilityControlStatus" ><label for="StabilityControlStatus">StabilityControlStatus</label><br>
        									<input type="checkbox" name="brake" value="BrakeBoostApplied" id="BrakeBoostApplied" ><label for="BrakeBoostApplied">BrakeBoostApplied</label>
        								</div>
        								<div>
        									<input type="checkbox" name="brake" value="AuxiliaryBrakeStatus" id="AuxiliaryBrakeStatus" ><label for="AuxiliaryBrakeStatus">AuxiliaryBrakeStatus</label>
        								</div>
									</div>
								</div>
							</div>
						</div>

						<div class="row map-content" style="height: 766px;">
								<div id="allmap" style="height: 100%;"></div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<!-- JQuery -->
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<!-- Waypoints -->
<script type="text/javascript" src="js/jquery.waypoints.min.js"></script>
<!-- Main -->
<script type="text/javascript" src="js/main.js"></script>
<!-- returnTologin -->
<script type="text/javascript" src="js/returnTologin.js"></script>

<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=3VqNyjz7iBM965mIrK7OTmA8u6V9pTTZ"></script>



<script type="text/javascript">

	function change_height(){
		var width=$("body").width();
		if(width>=766){
			var height=$(window).height();

			$(".map-content").height(function(n,c){
				return height-81-84-56;
			})
			var header_height=$(".header").height();
			$(".menu").height(function(n,c){
				return height-header_height;
			});
			$(".control").height(function(n,c){
				return height-header_height;
			});

			$('.menu_after').css({
					height:function(n,c){
					return height-header_height-100;
				},
					left:function(n,c){
						var menu_width=$(".menu").width();
					return menu_width;
				},
					display:function(n,c){
						return 'block';
					}
			});
		}else{
			$(".menu").height(60);
			$(".control").css('height',"auto");
			$(".menu").css("max-width","100%");
			$(".menu").css("min-height","0px");
			$('.menu_after').css({"display":"none"});
		}
	}
	change_height();
	$(window).resize(function(){
			change_height();
	});

	$(".online-title").on('click',function(){
		$(".offline-title").removeClass("is-online");
		$(".online-title").addClass("is-online");
	});
	$(".offline-title").on('click',function(){
		$(".online-title").removeClass("is-online");
		$(".offline-title").addClass("is-online");
	})

	$(".filter-title").on("mouseover",function(){
		$(".filter-content").children().css("display","none");
		var x=$(this).attr("data");
		$("."+x).css("display","block");

	})
	$(".filter-title").on("mouseout",function(){
		var x=$(this).attr("data");
	});

	// 百度地图API功能
	var map = new BMap.Map("allmap");
	var point = new BMap.Point(116.404, 39.915);
	map.centerAndZoom(point, 15);
	map.enableScrollWheelZoom();
	map.clearOverlays();  
	// 编写自定义函数,创建标注
	function addMarker(point){
	  var marker = new BMap.Marker(point);
	  map.addOverlay(marker);
	}
	// 随机向地图添加25个标注
	var bounds = map.getBounds();

	var sw = bounds.getSouthWest();
	var ne = bounds.getNorthEast();
	var lngSpan = Math.abs(sw.lng - ne.lng);
	var latSpan = Math.abs(ne.lat - sw.lat);
	for (var i = 0; i < 10; i ++) {
		var point = new BMap.Point(sw.lng + lngSpan * (Math.random() * 0.7), ne.lat - latSpan * (Math.random() * 0.7));
		addMarker(point);
	}

	var linesPoints = null;
	var spoi1 = new BMap.Point(116.380967,39.913285);    // 起点1
	var spoi2 = new BMap.Point(116.380967,39.953285);    // 起点2
	var epoi  = new BMap.Point(116.424374,39.914668);    // 终点
	var myIcon = new BMap.Icon("http://lbsyun.baidu.com/jsdemo/img/Mario.png", new BMap.Size(32, 70), {imageOffset: new BMap.Size(0, 0)});
	function initLine(){
		bounds = new Array();
		linesPoints = new Array();                                                  // 清空覆盖物
		var driving3 = new BMap.DrivingRoute(map,{onSearchComplete:drawLine});  // 驾车实例,并设置回调
			driving3.search(spoi1, epoi); 
			                                      // 搜索一条线路

		var driving4 = new BMap.DrivingRoute(map, {onSearchComplete:drawLine2});  // 驾车实例,并设置回调

			driving4.search(spoi1, epoi,{waypoints:["北京北站","北京国际会议中心"]});
	}

	var isCenter=true;
	var isCenterTime=0;
	map.addEventListener("dragstart", function(evt){
		isCenterTime=0;
		isCenter=false;
		cancelCenter=setInterval(function(){
			var sumTime=3;
			if(isCenterTime==sumTime){
				isCenter=true;
			}
			else if(isCenterTime>sumTime){
				isCenterTime=10;
			}
			else{
				isCenterTime++;
			}
		},1000);
	});

	var route_to_go;
	var linesPoint = new Array;
	function run(){
		linesPoint.push(linesPoints[0][0]);
		linesPoint.push(linesPoints[0][1]);
		map.centerAndZoom(linesPoint[0],16);
		var carMk = new BMap.Marker(linesPoint[0],{icon:myIcon});
		// carMk.setAnimation(BMAP_ANIMATION_BOUNCE);//跳动的动画
		map.addOverlay(carMk);
		carMk.setPosition(linesPoint[0]);

		resetMkPoint(3,linesPoints[0].length)
		function resetMkPoint(i,len){
			if(i < linesPoints[0].length){

				setTimeout(function(){

					linesPoint.push(linesPoints[0][i]);
					i++;
					if(i<len){	
						var la_lat=linesPoint[i-3].lat*1000000;
						var la_lng=linesPoint[i-3].lng*1000000;
						var new_lat=linesPoint[i-2].lat*1000000;
						var new_lng=linesPoint[i-2].lng*1000000;
						var x= degree(new_lat,new_lng,la_lat,la_lng);
						carMk.setRotation(x);
						// move_detail(linesPoint[i-2],linesPoint[i-3],carMk);
						carMk.setPosition(linesPoint[i-3]);
						var route_go_line = new BMap.Polyline(linesPoint, { strokeColor: "red", strokeWeight: 4, strokeOpacity: 1 });   //创建折线
            			map.addOverlay(route_go_line);   //增加折线 
						// route_go_line.remove(); 
            			if(isCenter==true){
            				map.panTo(linesPoint[i-2]);
            			}
					}
					resetMkPoint(i,len);
				},100);
			}
		}

		function move_detail(curpoint, targetpoint,carMk){
			var curpo=map.pointToPixel(curpoint);
			var targetpo=map.pointToPixel(targetpoint);
			var cur_lat=curpo.x;
			var cur_lng=curpo.y;
			var tar_lat=targetpo.x;
			var tar_lng=targetpo.y;
			var point;
			var lin=new Array;
			var route_go_line_detail
			if(tar_lat==cur_lat){
				var k=(tar_lng-cur_lng)/100;
				for(var j=0;j<100;j++){
					point = {
						x:cur_lat,
						y:cur_lng+(j+1)*k
					}
					point=map.pixelToPoint(point);
					
					setTimeout(function(){
						carMk.setPosition(point);
					},1);	

					if(j!=0){
						route_go_line_detail.remove(); 
					} 
					lin.push(point);
					route_go_line_detail = new BMap.Polyline(lin, { strokeColor: "red", strokeWeight: 4, strokeOpacity: 1 });   //创建折线
		            map.addOverlay(route_go_line_detail);   //增加折线 
				}	
			}else{
				var k=(tar_lng-cur_lng)/(tar_lat-cur_lat);
				for(var j=0;j<100;j++){
					point = {
						x:cur_lat+(tar_lat-cur_lat)/100*(j+1),
						y:cur_lng+(tar_lat-cur_lat)/100*(j+1)*k
					}
					point=map.pixelToPoint(point);
					
					setTimeout(function(){
						carMk.setPosition(point);
					},1);
					if(j!=0){
						route_go_line_detail.remove(); 
					}
					lin.push(point);
					route_go_line_detail = new BMap.Polyline(lin, { strokeColor: "red", strokeWeight: 4, strokeOpacity: 1 });   //创建折线
		            map.addOverlay(route_go_line_detail);   //增加折线
				}
			}

		}

		function degree(px,py,mx,my){//获得人物中心和鼠标坐标连线，与y轴正半轴之间的夹角
        	var x = Math.abs(px-mx);
        	var y = Math.abs(py-my);
        	var z = Math.sqrt(Math.pow(x,2)+Math.pow(y,2));
        	var cos = y/z;
        	var radina = Math.acos(cos);//用反三角函数求弧度
        	var angle = Math.floor(180/(Math.PI/radina));//将弧度转换成角度
        	
        	if(mx>px&&my>py){//鼠标在第四象限
            angle = 180 - angle;
	        }

	        if(mx==px&&my>py){//鼠标在y轴负方向上
	            angle = 180;
	        }

	        if(mx>px&&my==py){//鼠标在x轴正方向上
	            angle = 90;
	        }

	        if(mx<px&&my>py){//鼠标在第三象限
	            angle = 180+angle;
	        }

	        if(mx<px&&my==py){//鼠标在x轴负方向
	            angle = 270;
	        }

	        if(mx<px&&my<py){//鼠标在第二象限
	            angle = 360 - angle;
	        }
        	return angle;
		}
		
	}

	function drawLine2(results){
		var opacity = 1;
		var planObj = results.getPlan(0);
		var addMarkerFun = function(point,imgType,index,title){
			var url;
			var width;
			var height
			var myIcon;
			// imgType:1的场合，为起点和终点的图；2的场合为车的图形
			if(imgType == 1){
				url = "http://lbsyun.baidu.com/jsdemo/img/dest_markers.png";
				width = 42;
				height = 34;
				myIcon = new BMap.Icon(url,new BMap.Size(width, height),{offset: new BMap.Size(14, 32),imageOffset: new BMap.Size(0, 0 - index * height)});
			}else{
				url = "http://lbsyun.baidu.com/jsdemo/img/trans_icons.png";
				width = 22;
				height = 25;
				var d = 25;
				var cha = 0;
				var jia = 0
				if(index == 2){
					d = 21;
					cha = 5;
					jia = 1;
				}
				myIcon = new BMap.Icon(url,new BMap.Size(width, d),{offset: new BMap.Size(10, (11 + jia)),imageOffset: new BMap.Size(0, 0 - index * height - cha)});
			}
			
			var marker = new BMap.Marker(point, {icon: myIcon});
			if(title != null && title != ""){
				marker.setTitle(title);
			}
			// 起点和终点放在最上面
			if(imgType == 1){
				marker.setTop(true);
			}
			map.addOverlay(marker);
		}
		var addPoints = function(points){
			for(var i = 0; i < points.length; i++){
				bounds.push(points[i]);
			}
		}
		// 绘制驾车步行线路
		for (var i = 0; i < planObj.getNumRoutes(); i ++){
			var route = planObj.getRoute(i);
			if (route.getDistance(false) <= 0){continue;}
			addPoints(route.getPath());
			// 驾车线路
			if(route.getRouteType() == BMAP_ROUTE_TYPE_DRIVING){
				route_to_go=map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "green",strokeOpacity:opacity,strokeWeight:4,enableMassClear:true}));
			}else{
			// 步行线路有可能为0
				map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "#ddd",strokeOpacity:0.75,strokeWeight:4,enableMassClear:true}));
			}
		}	
		map.setViewport(bounds);	
		// 终点
		addMarkerFun(results.getEnd().point,1,1);
		// 开始点
		addMarkerFun(results.getStart().point,1,0);
	}
	function drawLine(results){
		var opacity = 1;
		var planObj = results.getPlan(0);
		var b = new Array();
		var addMarkerFun = function(point,imgType,index,title){
			var url;
			var width;
			var height
			var myIcon;
			// imgType:1的场合，为起点和终点的图；2的场合为车的图形
			if(imgType == 1){
				url = "http://lbsyun.baidu.com/jsdemo/img/dest_markers.png";
				width = 42;
				height = 34;
				myIcon = new BMap.Icon(url,new BMap.Size(width, height),{offset: new BMap.Size(14, 32),imageOffset: new BMap.Size(0, 0 - index * height)});
			}else{
				url = "http://lbsyun.baidu.com/jsdemo/img/trans_icons.png";
				width = 22;
				height = 25;
				var d = 25;
				var cha = 0;
				var jia = 0
				if(index == 2){
					d = 21;
					cha = 5;
					jia = 1;
				}
				myIcon = new BMap.Icon(url,new BMap.Size(width, d),{offset: new BMap.Size(10, (11 + jia)),imageOffset: new BMap.Size(0, 0 - index * height - cha)});
			}
			
			var marker = new BMap.Marker(point, {icon: myIcon});
			if(title != null && title != ""){
				marker.setTitle(title);
			}
			// 起点和终点放在最上面
			if(imgType == 1){
				marker.setTop(true);
			}
			map.addOverlay(marker);
		}
		var addPoints = function(points){
			for(var i = 0; i < points.length; i++){
				bounds.push(points[i]);
				b.push(points[i]);
			}
		}
		// 绘制驾车步行线路
		for (var i = 0; i < planObj.getNumRoutes(); i ++){
			var route = planObj.getRoute(i);
			if (route.getDistance(false) <= 0){continue;}
			addPoints(route.getPath());
			// 驾车线路
			if(route.getRouteType() == BMAP_ROUTE_TYPE_DRIVING){
				// map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "red",strokeOpacity:opacity,strokeWeight:4,enableMassClear:true}));
			}else{
			// 步行线路有可能为0
				map.addOverlay(new BMap.Polyline(route.getPath(), {strokeColor: "#ddd",strokeOpacity:0.75,strokeWeight:4,enableMassClear:true}));
			}
		}	
		map.setViewport(bounds);	
		// 终点
		addMarkerFun(results.getEnd().point,1,1);
		// 开始点
		addMarkerFun(results.getStart().point,1,0);
		linesPoints[linesPoints.length] = b;
	}
	initLine();
	setTimeout(function(){
		run();
	},1500);

</script>
</html>